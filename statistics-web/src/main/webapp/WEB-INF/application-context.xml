<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~ Copyright (C) 2013 - 2014 Inera AB (http://www.inera.se)
  ~
  ~     This file is part of Inera Statistics (http://code.google.com/p/inera-statistics/).
  ~
  ~     Inera Statistics is free software: you can redistribute it and/or modify
  ~     it under the terms of the GNU LESSER GENERAL PUBLIC LICENSE as published by
  ~     the Free Software Foundation, either version 3 of the License, or
  ~     (at your option) any later version.
  ~
  ~     Inera Statistics is distributed in the hope that it will be useful,
  ~     but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~     GNU LESSER GENERAL PUBLIC LICENSE for more details.
  ~
  ~     You should have received a copy of the GNU LESSER GENERAL PUBLIC LICENSE
  ~     along with this program.  If not, see <http://www.gnu.org/licenses/>.
  -->
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.2.xsd
    ">

    <beans profile="test">
        <context:property-placeholder location="file:${user.home}/.test.statistik.se/config.properties" order="1" ignore-resource-not-found="true" ignore-unresolvable="true"/>
        <context:property-placeholder location="classpath*:default.test.properties" order="2" ignore-resource-not-found="false" ignore-unresolvable="true"/>
    </beans>
    <beans profile="qa">
        <context:property-placeholder location="file:${statistics.config.file}" order="1" ignore-resource-not-found="false" ignore-unresolvable="true"/>
        <context:property-placeholder location="classpath*:default.qa.properties" order="2" ignore-resource-not-found="false" ignore-unresolvable="true"/>
    </beans>
    <beans profile="dev">
        <context:property-placeholder location="classpath*:default.dev.properties" order="1" ignore-resource-not-found="true" ignore-unresolvable="true"/>
    </beans>

    <beans>
      <bean id="messageSource" class="org.springframework.context.support.ResourceBundleMessageSource">
        <property name="basenames">
          <list>
            <value>version</value>
          </list>
        </property>
      </bean>
    </beans>

    <beans profile="!embedded">
        <import resource="classpath*:process-log-impl.xml"/>
    </beans>
    <beans profile="embedded">
        <import resource="classpath*:embedded-process-log-impl.xml"/>
    </beans>

    <beans>
        <context:property-placeholder location="classpath*:application-context.properties" order="3" ignore-resource-not-found="false" ignore-unresolvable="false"/>

        <bean id="loginVisibility" class="se.inera.auth.LoginVisibility"/>

        <bean id="applicationContextProvider" class="se.inera.auth.ApplicationContextProvider"/>

        <bean class="se.inera.statistics.hsa.services.HsaOrganizationsServiceImpl"/>
        <bean id="chartDataService" class="se.inera.statistics.web.service.ChartDataService"/>

        <bean id="protectedChartDataService" class="se.inera.statistics.web.service.ProtectedChartDataService"/>

        <bean class="se.inera.statistics.service.report.model.Lan" id="lan"/>
        <bean id="loginInfoService" class="se.inera.statistics.web.service.LoginInfoService"/>

        <import resource="classpath*:hsa-services-config.xml"/>
        <import resource="classpath*:hsa-stub-context.xml"/>
        <import resource="application-context-cxf.xml"/>
        <import resource="application-context-security.xml"/>
        <import resource="application-context-jmx.xml"/>

        <context:annotation-config/>
        <context:component-scan base-package="se.inera.statistics.service"/>

        <bean class="se.inera.statistics.service.report.util.DiagnosisGroupsUtil"/>
        <bean class="org.springframework.core.io.ClassPathResource" id="icd10ChaptersAnsiFile">
            <constructor-arg value="KSH97_AVS.ANS"/>
        </bean>
        <bean class="org.springframework.web.context.support.ServletContextAttributeExporter">
             <property name="attributes">
                 <map>
                     <entry key="loginUrl" value="${login.url}"/>
                     <entry key="highchartsExportUrl" value="${highcharts.export.url}"/>
                     <entry key="healthcheckUtil" value-ref="healthcheckUtil"/>
                 </map>
             </property>
         </bean>
        <bean id="nationalPercistenceHandler" class="se.inera.statistics.service.report.repository.NationellPersistenceHandler"/>
        <bean id="healthcheckUtil" class="se.inera.statistics.web.util.HealthCheckUtil" />
      </beans>

    <beans profile="!demo,!test,!db,!qa">
        <bean class="se.inera.statistics.service.report.mock.SjukfallPerManadMock" id="casesPerMonth"/>
        <bean class="se.inera.statistics.service.report.mock.DiagnosgruppMock" id="diagnosisGroups"/>
        <bean class="se.inera.statistics.service.report.mock.DiagnoskapitelMock" id="diagnosisSubGroups"/>
        <bean class="se.inera.statistics.service.report.mock.OverviewMock" id="overview"/>
        <bean class="se.inera.statistics.service.report.mock.VerksamhetOverviewMock" id="verksamhetOverview"/>
        <bean class="se.inera.statistics.service.report.mock.AldersgruppMock" id="ageGroups"/>
        <bean class="se.inera.statistics.service.report.mock.SjukskrivningsgradMock" id="degreeOfSickLeave"/>
        <bean class="se.inera.statistics.service.report.mock.SjukfallslangdGruppMock" id="sickLeaveLength"/>
        <bean class="se.inera.statistics.service.report.mock.SjukfallPerLanMock" id="casesPerCounty"/>
    </beans>

    <beans profile="demo,test,db,qa">
        <import resource="application-context-qm.xml"/>

        <bean class="se.inera.statistics.service.common.CommonPersistenceHandler" id="commonPersistenceHandler"/>
        <bean class="se.inera.statistics.service.report.repository.SjukfallPerManadPersistenceHandler"
              id="casesPerMonth"/>
        <bean class="se.inera.statistics.service.report.repository.DiagnosgroupPersistenceHandler"
              id="diagnosisGroups"/>
        <bean class="se.inera.statistics.service.report.repository.DiagnossubgroupPersistenceHandler"
              id="diagnosisSubGroups"/>
        <bean class="se.inera.statistics.service.report.repository.OverviewPersistenceHandler" id="overview"/>
        <bean class="se.inera.statistics.service.report.repository.VerksamhetOverviewPersistenceHandler"
              id="verksamhetOverview"/>
        <bean class="se.inera.statistics.service.report.repository.AldersgruppPersistenceHandler" id="ageGroups"/>
        <bean class="se.inera.statistics.service.report.repository.SjukskrivningsgradPersistenceHandler"
              id="degreeOfSickLeave"/>
        <bean class="se.inera.statistics.service.report.repository.SjukfallslangdGruppPersistenceHandler"
              id="sickLeaveLength"/>
        <bean class="se.inera.statistics.service.report.repository.SjukfallPerLanPersistenceHandler"
              id="casesPerCounty"/>
    </beans>

    <beans profile="demo,generatesmalltestdata">
        <bean class="se.inera.statistics.service.demo.InjectUtlatande" lazy-init="false"/>
    </beans>
    <beans profile="generatetestdata">
        <bean class="se.inera.statistics.service.common.CommonPersistenceHandler"/>
        <bean class="se.inera.statistics.service.queue.Receiver"/>
        <bean class="se.inera.statistics.service.demo.InjectUtlatande2" lazy-init="false"/>
    </beans>
</beans>
