<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE Configure PUBLIC "-//Mort Bay Consulting//DTD Configure//EN" "http://www.eclipse.org/jetty/configure.dtd">
<!--
  This file is used when running Jetty embedded
-->
<Configure id="wac" class="org.eclipse.jetty.webapp.WebAppContext">

    <Call name="setAttribute">
        <Arg>org.eclipse.jetty.server.webapp.WebInfIncludeJarPattern</Arg>
        <Arg>
            .*/.*jsp-api-[^/]\.jar$|./.*jsp-[^/]\.jar$|./.*taglibs[^/]*\.jar$
        </Arg>
    </Call>

    <New id="DataSource" class="org.eclipse.jetty.plus.jndi.Resource">
        <Arg>
            <Ref refid="wac"/>
        </Arg>
        <Arg>jdbc/statistik</Arg>
        <Arg>
            <New class="com.mysql.jdbc.jdbc2.optional.MysqlConnectionPoolDataSource">
                <Set name="Url">jdbc:mysql://localhost:3306/statistik</Set>
                <Set name="User">statistik</Set>
                <Set name="Password">statistik</Set>
            </New>
        </Arg>
    </New>

    <!--The pooled connection can't, for some reason, be used when we run the fitnesse tests locally
    But we do need a pooled connection for those times when we want to run activemq embedded locally. This typically happens
    when we run the app with the spring profiles qm and active.
    -->
    <New id="jmsConnectionFactory" class="org.eclipse.jetty.plus.jndi.Resource">
        <Arg>
            <Ref refid="wac"/>
        </Arg>
        <Arg>jms/ConnectionFactory</Arg>
        <Arg>
            <New class="org.apache.activemq.pool.PooledConnectionFactory">
                <Arg>
                    <New class="org.apache.activemq.ActiveMQConnectionFactory">
                        <!--Arg>vm://localhost?broker.useJmx=true&amp;broker.persistent=false</Arg-->
                        <Arg>tcp://localhost:61616</Arg>
                    </New>
                </Arg>
            </New>
        </Arg>
    </New>

    <New id="jmsQueue" class="org.eclipse.jetty.plus.jndi.Resource">
        <Arg>
            <Ref refid="wac"/>
        </Arg>
        <Arg>jms/Queue</Arg>
        <Arg>
            <New class="org.apache.activemq.command.ActiveMQQueue">
                <Arg>statistik.utlatande.queue</Arg>
            </New>
        </Arg>
    </New>

</Configure>
