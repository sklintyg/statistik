<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~ Copyright (C) 2013 - 2014 Inera AB (http://www.inera.se)
  ~
  ~     This file is part of Inera Statistics (http://code.google.com/p/inera-statistics/).
  ~
  ~     Inera Statistics is free software: you can redistribute it and/or modify
  ~     it under the terms of the GNU LESSER GENERAL PUBLIC LICENSE as published by
  ~     the Free Software Foundation, either version 3 of the License, or
  ~     (at your option) any later version.
  ~
  ~     Inera Statistics is distributed in the hope that it will be useful,
  ~     but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~     GNU LESSER GENERAL PUBLIC LICENSE for more details.
  ~
  ~     You should have received a copy of the GNU LESSER GENERAL PUBLIC LICENSE
  ~     along with this program.  If not, see <http://www.gnu.org/licenses/>.
  -->
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.0.xsd
    http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.0.xsd
    ">

    <beans profile="!dev">
        <context:property-placeholder location="file:${statistics.credentials.file}, file:${statistics.config.file}"
                                      order="1" ignore-resource-not-found="false" ignore-unresolvable="true"/>
    </beans>
    <beans profile="dev">
        <context:property-placeholder location="classpath*:default.dev.properties"
                                      order="1" ignore-resource-not-found="true" ignore-unresolvable="true"/>
      <bean class="se.inera.statistics.service.hsa.HSAServiceMock"/>
      <bean class="se.inera.statistics.hsa.stub.BootstrapBean"/>
    </beans>

    <beans>
        <bean id="messageSource" class="org.springframework.context.support.ResourceBundleMessageSource">
            <property name="basenames">
                <list>
                    <value>version</value>
                    <value>buildtime</value>
                    <value>buildhost</value>
                </list>
            </property>
        </bean>
    </beans>

    <beans profile="!embedded">
        <import resource="classpath*:process-log-impl.xml"/>
    </beans>
    <beans profile="embedded">
        <import resource="classpath*:embedded-process-log-impl.xml"/>
    </beans>

    <beans>
        <context:property-placeholder location="classpath*:application-context.properties" order="2"
                                      ignore-resource-not-found="false" ignore-unresolvable="false"/>

        <bean id="loginVisibility" class="se.inera.auth.LoginVisibility"/>

        <bean id="applicationContextProvider" class="se.inera.auth.ApplicationContextProvider"/>

        <bean class="se.inera.statistics.hsa.services.HsaOrganizationsServiceImpl"/>
        <bean id="filterHashHandler" class="se.inera.statistics.web.service.FilterHashHandler"/>
        <bean id="resultMessageHandler" class="se.inera.statistics.web.service.ResultMessageHandler"/>
        <bean id="chartDataService" class="se.inera.statistics.web.service.ChartDataService"/>

        <bean id="protectedChartDataService" class="se.inera.statistics.web.service.ProtectedChartDataService"/>
        <bean id="protectedLandstingService" class="se.inera.statistics.web.service.ProtectedLandstingService"/>

        <bean class="se.inera.statistics.service.report.model.Lan" id="lan"/>
        <bean id="loginInfoService" class="se.inera.statistics.web.service.LoginInfoService"/>
        <bean id="loggingService" class="se.inera.statistics.web.service.LoggingService"/>

        <import resource="classpath*:hsa-services-config.xml"/>
        <import resource="classpath*:hsa-stub-context.xml"/>
        <import resource="classpath*:icd10.xml"/>
        <import resource="application-context-cxf.xml"/>
        <import resource="application-context-security.xml"/>
        <import resource="application-context-jmx.xml"/>
        <import resource="application-context-qm.xml"/>

        <context:annotation-config/>
        <context:component-scan base-package="se.inera.statistics.service"/>

        <bean id="receiver" class="se.inera.statistics.service.processlog.Receiver"/>

        <bean class="org.springframework.web.context.support.ServletContextAttributeExporter">
            <property name="attributes">
                <map>
                    <entry key="loginUrl" value="${login.url}"/>
                    <entry key="highchartsExportUrl" value="${highcharts.export.url}"/>
                    <entry key="healthcheckUtil" value-ref="healthcheckUtil"/>
                </map>
            </property>
        </bean>

        <bean id="healthcheckUtil" class="se.inera.statistics.web.util.HealthCheckUtil"/>

        <bean id="warehouse" class="se.inera.statistics.service.warehouse.Warehouse" />
        <bean id="warehouseManager" class="se.inera.statistics.service.warehouse.WarehouseManager" />
        <bean id="warehouseService" class="se.inera.statistics.web.service.WarehouseService" />

        <bean id="factPopulator" class="se.inera.statistics.service.warehouse.FactPopulator" />
        <bean id="widelineConverter" class="se.inera.statistics.service.warehouse.WidelineConverter" />

        <bean class="se.inera.statistics.service.processlog.Processor" />
        <bean class="se.inera.statistics.web.service.LoginServiceUtil" />
        <bean class="se.inera.statistics.web.service.FilterHandler" />
    </beans>

    <beans profile="hsacached">
        <bean class="se.inera.statistics.service.hsa.HsaWebServiceCached" />
    </beans>
    <beans profile="!hsacached">
        <bean class="se.inera.statistics.service.hsa.HsaWebServiceDirect" />
    </beans>

    <beans profile="db-resetter">
        <bean class="se.inera.statistics.service.common.CommonPersistenceHandler" id="commonPersistenceHandler"/>
    </beans>

    <beans profile="embedded">
        <bean class="se.inera.statistics.service.demo.InjectUtlatande" lazy-init="false"/>
    </beans>
</beans>
