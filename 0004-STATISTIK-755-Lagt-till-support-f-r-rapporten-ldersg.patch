From 595ab9cbf2a0d9f72494b3891c3337deb1f98fdf Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Fredrik=20Engstro=CC=88m?=
 <fredrik.engstrom@callistaenterprise.se>
Date: Tue, 2 Dec 2014 12:53:49 +0100
Subject: [PATCH] =?UTF-8?q?STATISTIK-755=20Lagt=20till=20support=20f=C3=B6?=
 =?UTF-8?q?r=20rapporten=20=C3=A5ldersgrupp=20p=C3=A5g=C3=A5ende=20i=20fit?=
 =?UTF-8?q?nesse?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

---
 .../inera/statistics/spec/SimpleDetailsReport.groovy   |  7 +++++++
 .../spec/SjukfallIRapportenAldersgruppPagaende.groovy  | 18 ++++++++++++++++++
 ...SjukfallIRapportenAldersgruppPagaendeDiagram.groovy | 18 ++++++++++++++++++
 .../se/inera/statistics/web/reports/ReportsUtil.groovy |  3 +++
 .../AldersgruppPagaendeExempel/content.txt             | 17 +++++++++++++++++
 .../AldersgruppPagaendeExempel/properties.xml          | 14 ++++++++++++++
 6 files changed, 77 insertions(+)
 create mode 100644 specifications/src/main/groovy/se/inera/statistics/spec/SjukfallIRapportenAldersgruppPagaende.groovy
 create mode 100644 specifications/src/main/groovy/se/inera/statistics/spec/SjukfallIRapportenAldersgruppPagaendeDiagram.groovy
 create mode 100644 specifications/src/test/fitnesse/FitNesseRoot/StatisticsTests/AldersgruppPagaendeExempel/content.txt
 create mode 100644 specifications/src/test/fitnesse/FitNesseRoot/StatisticsTests/AldersgruppPagaendeExempel/properties.xml

diff --git a/specifications/src/main/groovy/se/inera/statistics/spec/SimpleDetailsReport.groovy b/specifications/src/main/groovy/se/inera/statistics/spec/SimpleDetailsReport.groovy
index e432ef2..59c8310 100644
--- a/specifications/src/main/groovy/se/inera/statistics/spec/SimpleDetailsReport.groovy
+++ b/specifications/src/main/groovy/se/inera/statistics/spec/SimpleDetailsReport.groovy
@@ -54,6 +54,13 @@ abstract class SimpleDetailsReport extends Rapport {
         return reportsUtil.getReportAldersgrupp();
     }
 
+    def getReportAldersgruppPagaende() {
+        if (inloggad) {
+            return reportsUtil.getReportAldersgruppPagaendeInloggad(inloggadSom);
+        }
+        throw new RuntimeException("Report -Sjukfall per enhet- is not available on national level");
+    }
+
     def getReportSjukskrivningslangd() {
         if (inloggad) {
             return reportsUtil.getReportSjukskrivningslangdInloggad(inloggadSom);
diff --git a/specifications/src/main/groovy/se/inera/statistics/spec/SjukfallIRapportenAldersgruppPagaende.groovy b/specifications/src/main/groovy/se/inera/statistics/spec/SjukfallIRapportenAldersgruppPagaende.groovy
new file mode 100644
index 0000000..6ac25f0
--- /dev/null
+++ b/specifications/src/main/groovy/se/inera/statistics/spec/SjukfallIRapportenAldersgruppPagaende.groovy
@@ -0,0 +1,18 @@
+package se.inera.statistics.spec
+
+class SjukfallIRapportenAldersgruppPagaende extends SimpleDetailsReport {
+
+    def åldersgrupp
+
+    @Override
+    public void doExecute() {
+        def report = getReportAldersgruppPagaende()
+        executeTabell(report)
+    }
+
+    @Override
+    def getRowNameMatcher() {
+        return åldersgrupp
+    }
+
+}
diff --git a/specifications/src/main/groovy/se/inera/statistics/spec/SjukfallIRapportenAldersgruppPagaendeDiagram.groovy b/specifications/src/main/groovy/se/inera/statistics/spec/SjukfallIRapportenAldersgruppPagaendeDiagram.groovy
new file mode 100644
index 0000000..9188401
--- /dev/null
+++ b/specifications/src/main/groovy/se/inera/statistics/spec/SjukfallIRapportenAldersgruppPagaendeDiagram.groovy
@@ -0,0 +1,18 @@
+package se.inera.statistics.spec
+
+class SjukfallIRapportenAldersgruppPagaendeDiagram extends SimpleDetailsReport {
+
+    def åldersgrupp
+
+    @Override
+    public void doExecute() {
+        def report = getReportAldersgruppPagaende()
+        executeDiagram(report)
+    }
+
+    @Override
+    def getRowNameMatcher() {
+        return åldersgrupp
+    }
+
+}
diff --git a/specifications/src/main/groovy/se/inera/statistics/web/reports/ReportsUtil.groovy b/specifications/src/main/groovy/se/inera/statistics/web/reports/ReportsUtil.groovy
index c62c123..4ad34ba 100644
--- a/specifications/src/main/groovy/se/inera/statistics/web/reports/ReportsUtil.groovy
+++ b/specifications/src/main/groovy/se/inera/statistics/web/reports/ReportsUtil.groovy
@@ -148,4 +148,7 @@ class ReportsUtil {
         return get("/api/verksamhet/" + getVardgivareForUser(user) + "/getSickLeaveLengthData")
     }
 
+    def getReportAldersgruppPagaendeInloggad(String user) {
+        return get("/api/verksamhet/" + getVardgivareForUser(user) + "/getAgeGroupsCurrentStatistics")
+    }
 }
diff --git a/specifications/src/test/fitnesse/FitNesseRoot/StatisticsTests/AldersgruppPagaendeExempel/content.txt b/specifications/src/test/fitnesse/FitNesseRoot/StatisticsTests/AldersgruppPagaendeExempel/content.txt
new file mode 100644
index 0000000..fe9bd56
--- /dev/null
+++ b/specifications/src/test/fitnesse/FitNesseRoot/StatisticsTests/AldersgruppPagaendeExempel/content.txt
@@ -0,0 +1,17 @@
+!contents -R2 -g -p -f -h
+
+
+!3 Givet att:
+| script | dagens datum | 2014-11-28 |
+
+| Enbart foljande intyg finns |
+| personnr      | start      | slut       | enhet  | kommentar |
+| 19880701-0015 | 2014-06-01 | 2014-06-15 | enhet1 | |
+| 19880701-1015 | 2014-11-01 | 2014-12-01 | enhet1 | |
+
+
+!3 Då gäller:
+Inloggad nivå
+| Sjukfall i rapporten aldersgrupp |
+| inloggad som | vårdgivarnivå | åldersgrupp | män? | kvinnor? |
+| user2        | false         | 21-25 år    | 1    | 0        |
diff --git a/specifications/src/test/fitnesse/FitNesseRoot/StatisticsTests/AldersgruppPagaendeExempel/properties.xml b/specifications/src/test/fitnesse/FitNesseRoot/StatisticsTests/AldersgruppPagaendeExempel/properties.xml
new file mode 100644
index 0000000..9f678a9
--- /dev/null
+++ b/specifications/src/test/fitnesse/FitNesseRoot/StatisticsTests/AldersgruppPagaendeExempel/properties.xml
@@ -0,0 +1,14 @@
+<?xml version="1.0"?>
+<properties>
+	<Edit/>
+	<Files/>
+	<Help></Help>
+	<Properties/>
+	<RecentChanges/>
+	<Refactor/>
+	<Search/>
+	<Test/>
+	<Suites></Suites>
+	<Versions/>
+	<WhereUsed/>
+</properties>
-- 
2.2.0

