ext.wsdlFile = file("src/main/resources/schemas/wsdl/HsaWsInteraction_3.18.wsdl")
ext.generatedJavaDir = file("generatedSource/java")

sourceSets.main.java {
    srcDir generatedJavaDir
}

clean.doLast { ant.delete(dir: generatedJavaDir.parent) }

configurations {
    wsdlgen
}

if (project.hasProperty("codeQuality")) {
    license {
        exclude "**/*.java" // This excludes too many files, but "generatedSource/**/*.java" does not work for some reason.
    }
}

task wsdl2Java(type: JavaExec) {
    inputs.files wsdlFile
    outputs.dir generatedJavaDir
    classpath configurations.wsdlgen
    jvmArgs "-Djavax.xml.accessExternalSchema=all"
    main "org.apache.cxf.tools.wsdlto.WSDLToJava"
    args "-xjc-XhashCode", "-xjc-Xequals", "-xjc-XtoString", "-xjc-Xinheritance",
            "-xjc-b,${projectDir}/src/main/resources/jaxb-bindings.xjb", "-validate", "-verbose",
            "-p", "urn:riv:hsa:HsaWs:3=se.inera.ifv.hsaws.v3",
            "-p", "urn:riv:hsa:HsaWsResponder:3=se.inera.ifv.hsawsresponder.v3",
            "-p", "http://www.w3.org/2005/08/addressing=org.w3.wsaddressing10", '-d', generatedJavaDir.path, wsdlFile
}

compileJava.dependsOn(wsdl2Java)

dependencies {
    compile "se.inera.intyg.infra:hsa-integration:${infraVersion}"

    compile "org.jvnet.jaxb2_commons:jaxb2-basics:${jaxb2Version}"
    compile "com.fasterxml.jackson.jaxrs:jackson-jaxrs-json-provider:${jacksonVersion}"
    compile "org.apache.cxf:cxf-rt-frontend-jaxrs:${cxfVersion}"
    compile "org.apache.cxf:cxf-rt-frontend-jaxws:${cxfVersion}"
    compile "org.springframework:spring-context:${springContextVersion}"
    compile "org.springframework.security:spring-security-web:${springSecurityVersion}"

    wsdlgen "org.apache.cxf:cxf-tools-wsdlto-frontend-jaxws:${cxfVersion}"
    wsdlgen "org.apache.cxf:cxf-tools-wsdlto-databinding-jaxb:${cxfVersion}"
    wsdlgen "org.jvnet.jaxb2_commons:jaxb2-basics:${jaxb2Version}"
}
